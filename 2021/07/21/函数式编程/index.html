

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  
    <meta name="description" content="JavaScript 语言从一诞生，就具有函数式编程的烙印。它将函数作为一种独立的数据类型，与其他数据类型处于完全平等的地位。在 JavaScript 语言中，你可以采用面向对象编程，也可以采用函数式编程。有人甚至说，JavaScript 是有史以来第一种被大规模采用的函数式编程语言。 为什么要学习函数式编程函数式编程是非常古老的一个概念，早于计算机的出生。 那我们为什么现在还要学习函数式编程呢？">
<meta property="og:type" content="article">
<meta property="og:title" content="函数式编程">
<meta property="og:url" content="http://example.com/2021/07/21/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/index.html">
<meta property="og:site_name" content="大大大前端一位，小小小北漂一枚">
<meta property="og:description" content="JavaScript 语言从一诞生，就具有函数式编程的烙印。它将函数作为一种独立的数据类型，与其他数据类型处于完全平等的地位。在 JavaScript 语言中，你可以采用面向对象编程，也可以采用函数式编程。有人甚至说，JavaScript 是有史以来第一种被大规模采用的函数式编程语言。 为什么要学习函数式编程函数式编程是非常古老的一个概念，早于计算机的出生。 那我们为什么现在还要学习函数式编程呢？">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2021/07/21/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/img.png">
<meta property="og:image" content="http://example.com/2021/07/21/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/img_1.png">
<meta property="article:published_time" content="2021-07-21T13:04:38.000Z">
<meta property="article:modified_time" content="2022-03-03T06:17:42.872Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="原创">
<meta property="article:tag" content="函数式编程">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://example.com/2021/07/21/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/img.png">
  
  
  <title>函数式编程 - 大大大前端一位，小小小北漂一枚</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.14","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"8rcPnaazaIKIPGc5YcAz2caW-gzGzoHsz","app_key":"49vPklmXhfvaJRzOy9LCGwbe","server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>

  
<meta name="generator" content="Hexo 6.0.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>howie&#39;s blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="函数式编程"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2021-07-21 21:04" pubdate>
          2021年7月21日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          20k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          165 分钟
        
      </span>
    

    
    
      
        <span id="leancloud-page-views-container" class="post-meta" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="leancloud-page-views"></span> 次
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">函数式编程</h1>
            
            <div class="markdown-body">
              
              <p>JavaScript 语言从一诞生，就具有函数式编程的烙印。它将函数作为一种独立的数据类型，与其他数据类型处于完全平等的地位。在 JavaScript 语言中，你可以采用面向对象编程，也可以采用函数式编程。有人甚至说，JavaScript 是有史以来第一种被大规模采用的函数式编程语言。</p>
<h2 id="为什么要学习函数式编程"><a href="#为什么要学习函数式编程" class="headerlink" title="为什么要学习函数式编程"></a>为什么要学习函数式编程</h2><p>函数式编程是非常古老的一个概念，早于计算机的出生。</p>
<p>那我们为什么现在还要学习函数式编程呢？</p>
<ul>
<li>函数式编程随着 React 的流行受到越来越多的关注</li>
<li>Vue3 也开始拥抱函数式编程</li>
<li>函数式编程可以抛弃 this</li>
<li>打包过程中可以更好的利用 tree shaking 过滤无用代码</li>
<li>方便测试、并行处理等</li>
<li>有很多库可以帮我们进行函数式开发：lodash、underscore、ramda</li>
</ul>
<h2 id="什么是函数式编程"><a href="#什么是函数式编程" class="headerlink" title="什么是函数式编程"></a>什么是函数式编程</h2><p>函数式编程(Functional Programming, FP), FP 是编程规范之一，我们常听说的编程范式还有面向过程编程、面向对象编程。</p>
<ul>
<li>面向对象编程思维：把现实世界中的事物抽象成程序世界中的对象和类，通过封装、继承和多态来演示事物事件的联系</li>
<li>函数式编程思维: 把现实世界的事物和事物之间的<strong>联系</strong>抽象到程序世界 (对运算过程进行抽象)<ul>
<li>程序的本质：根据输入通过某种运算获得相应的输出，程序开发过程中会涉及很多输入和输出的函数</li>
<li>x -&gt; y (联系、映射) -&gt; y, y &#x3D; f(x)</li>
<li><strong>函数式编程中的函数指的不是程序中的函数(方法)<strong>，而是数学中的函数即映射关系，例如：</strong>y &#x3D; sin(x)</strong>, x 和 y 的关系</li>
<li>相同的输入始终要得到相同的输出(纯函数)</li>
<li>函数式编程用来描述数据(函数)之间的映射</li>
</ul>
</li>
</ul>
<p>非函数式编程</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> num1 = <span class="hljs-number">2</span>;<br><span class="hljs-keyword">let</span> num2 = <span class="hljs-number">3</span>;<br><span class="hljs-keyword">let</span> sum = num1 + num2;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(sum)<br></code></pre></td></tr></table></figure>

<p>函数式-抽象了运算的过程</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span> (n1, n2) &#123;<br>  <span class="hljs-keyword">return</span> n1 + n2;<br>&#125;<br><span class="hljs-keyword">let</span> sum = <span class="hljs-title function_">add</span>(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>)<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(sum)<br></code></pre></td></tr></table></figure>


<h2 id="前置知识"><a href="#前置知识" class="headerlink" title="前置知识"></a>前置知识</h2><ul>
<li>函数是头等函数</li>
<li>高阶函数</li>
<li>闭包</li>
</ul>
<h3 id="函数是头等函数"><a href="#函数是头等函数" class="headerlink" title="函数是头等函数"></a>函数是头等函数</h3><ul>
<li>函数可以存储在变量中</li>
<li>函数可以作为参数</li>
<li>函数可以作为返回值</li>
</ul>
<p>在 JavaScript 中<strong>函数就是一个普通的对象</strong>(可以通过 new Function())，我们可以把函数存储到变量&#x2F;数组中，它还可以作为另一个函数的参数和返回值，<br>甚至我们可以在运行程序的时候通过 new Function(‘alert(1)’) 来构造一个新的函数。</p>
<ul>
<li>把函数赋值给变量<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 把函数赋值给变量</span><br><span class="hljs-keyword">let</span> fn = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Hello First-class Function&#x27;</span>)<br>&#125;<br><span class="hljs-title function_">fn</span>()<br><br><span class="hljs-comment">// 一个示例</span><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">BlogController</span> = &#123;<br>  index (posts) &#123; <span class="hljs-keyword">return</span> <span class="hljs-title class_">Views</span>.<span class="hljs-title function_">index</span>(posts) &#125;,<br>  show (posts) &#123; <span class="hljs-keyword">return</span> <span class="hljs-title class_">Views</span>.<span class="hljs-title function_">show</span>(posts) &#125;,<br>  create (attrs) &#123; <span class="hljs-keyword">return</span> <span class="hljs-title class_">Db</span>.<span class="hljs-title function_">create</span>(attrs) &#125;,<br>  update (posts, attrs) &#123; <span class="hljs-keyword">return</span> <span class="hljs-title class_">Db</span>.<span class="hljs-title function_">update</span>(posts, attrs) &#125;,<br>  destroy (posts) &#123; <span class="hljs-keyword">return</span> <span class="hljs-title class_">Db</span>.<span class="hljs-title function_">destroy</span>(posts) &#125;,<br>&#125;<br><br><span class="hljs-comment">// 优化</span><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">BlogController</span> = &#123;<br>  <span class="hljs-attr">index</span>: <span class="hljs-title class_">Views</span>.<span class="hljs-property">index</span>,<br>  <span class="hljs-attr">show</span>: <span class="hljs-title class_">Views</span>.<span class="hljs-property">show</span>,<br>  <span class="hljs-attr">create</span>: <span class="hljs-title class_">Db</span>.<span class="hljs-property">create</span>,<br>  <span class="hljs-attr">update</span>: <span class="hljs-title class_">Db</span>.<span class="hljs-property">update</span>,<br>  <span class="hljs-attr">destroy</span>: <span class="hljs-title class_">Db</span>.<span class="hljs-property">destroy</span>,<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="高阶函数"><a href="#高阶函数" class="headerlink" title="高阶函数"></a>高阶函数</h3><p>什么是高阶函数</p>
<ul>
<li><p>高阶函数(Higher-order function) HOF</p>
<ul>
<li>可以把函数作为参数传递给另个一个函数</li>
<li>可以把函数作为另一个函数的返回结果</li>
</ul>
<p>-函数作为参数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 模拟 forEach</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">forEach</span> (array, fn) &#123;<br>  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; array.<span class="hljs-property">length</span>; i++) &#123;<br>    <span class="hljs-title function_">fn</span>(array[i]);<br>  &#125;<br>&#125;<br>  <br><span class="hljs-keyword">let</span> array = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>];<br>  <br><span class="hljs-title function_">forEach</span>(array, <span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(item)<br>&#125;)<br>  <br><span class="hljs-comment">// 模拟 filter</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">filter</span>(<span class="hljs-params">array, fn</span>) &#123;<br>  <span class="hljs-keyword">let</span> result = [];<br>  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; array.<span class="hljs-property">length</span>; i++ ) &#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_">fn</span>(array[i])) &#123;<br>      result.<span class="hljs-title function_">push</span>(array[i]);<br>    &#125; <br>  &#125;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br>  <br><span class="hljs-keyword">let</span> newArray = <span class="hljs-title function_">filter</span>(array, <span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> &#123;<br>  <span class="hljs-keyword">return</span> item % <span class="hljs-number">2</span> === <span class="hljs-number">0</span>;<br>&#125;)<br>  <br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(newArray)<br></code></pre></td></tr></table></figure>
</li>
<li><p>作为返回值</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// once 只执行一次的函数，当前使用场景为支付</span><br> <span class="hljs-keyword">function</span> <span class="hljs-title function_">once</span> (fn) &#123;<br>   <span class="hljs-keyword">let</span> done = <span class="hljs-literal">false</span><br>   <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">...rest</span>) &#123;<br>     <span class="hljs-keyword">if</span>(!done) &#123;<br>       done = <span class="hljs-literal">true</span><br>       fn.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, rest)<br>     &#125;<br>   &#125;<br> &#125;<br> <br> <span class="hljs-keyword">let</span> pay = <span class="hljs-title function_">once</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">money</span>) &#123;<br>   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`我支付了￥<span class="hljs-subst">$&#123;money&#125;</span> RMB`</span>)<br> &#125;)<br><br> <span class="hljs-title function_">pay</span>(<span class="hljs-number">5</span>)<br> <span class="hljs-title function_">pay</span>(<span class="hljs-number">5</span>)<br> <span class="hljs-title function_">pay</span>(<span class="hljs-number">5</span>)<br><br></code></pre></td></tr></table></figure>
</li>
<li><p>高阶函数的意义</p>
<ul>
<li>抽象可以帮助我们屏蔽细节，只需要关注于我们的目标</li>
<li>高阶函数是用来抽象通用的问题<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 面向过程的方式</span><br><span class="hljs-keyword">let</span> array = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]<br><span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; array.<span class="hljs-property">length</span>; i ++) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(array[i])<br>&#125;<br>  <br><span class="hljs-comment">// 高阶函数</span><br><span class="hljs-keyword">let</span> array = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]<br><span class="hljs-title function_">forEach</span>(array, <span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(item)<br>&#125;)<br>  <br><span class="hljs-keyword">let</span> r = <span class="hljs-title function_">filter</span>(array, <span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> &#123;<br>    item % <span class="hljs-number">2</span> === <span class="hljs-number">0</span><br>&#125;)<br>  <br></code></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>常用的高阶函数</p>
<ul>
<li>数组方法<ul>
<li><code>forEach、map、filter、every、some、find/finedIndex、reduce、sort...</code><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 模拟 map 方法</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">map</span> = (<span class="hljs-params">array, fn</span>) =&gt; &#123;<br>   <span class="hljs-keyword">let</span> results = []<br>   <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> value <span class="hljs-keyword">of</span> array) &#123;<br>     results.<span class="hljs-title function_">push</span>(<span class="hljs-title function_">fn</span>(value))<br>   &#125;<br>   <span class="hljs-keyword">return</span> results;<br>&#125;<br><span class="hljs-keyword">let</span> arr = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]<br>arr = <span class="hljs-title function_">map</span>(arr, <span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item * item)<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr)<br><br><span class="hljs-comment">// every 是否都匹配指定的条件</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">every</span> = (<span class="hljs-params">array,fn</span>) =&gt; &#123;<br>   <span class="hljs-keyword">let</span> status = <span class="hljs-literal">true</span><br>   <span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> item <span class="hljs-keyword">of</span> array) &#123;<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_">fn</span>(item)) &#123;<br>      status = <span class="hljs-literal">false</span><br>      <span class="hljs-keyword">break</span><br>    &#125;<br>  &#125;<br>   <span class="hljs-keyword">return</span> status;<br>&#125;<br><br><span class="hljs-keyword">let</span> array = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]<br><span class="hljs-keyword">let</span> state = <span class="hljs-title function_">every</span>(array, <span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item &gt; <span class="hljs-number">10</span>)<br><span class="hljs-comment">// console.log(state)</span><br><br><span class="hljs-comment">// some 数组中是否有一个满足指定的条件</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">some</span> = (<span class="hljs-params">array, fn</span>) =&gt; &#123;<br>  <span class="hljs-keyword">let</span> status = <span class="hljs-literal">false</span><br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> item <span class="hljs-keyword">of</span> array) &#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_">fn</span>(item)) &#123;<br>      status = <span class="hljs-literal">true</span>;<br>      <span class="hljs-keyword">break</span><br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">return</span> status<br>&#125;<br><br><span class="hljs-keyword">let</span> array = [<span class="hljs-number">1</span>, <span class="hljs-number">5</span>, <span class="hljs-number">3</span>,<span class="hljs-number">7</span>, <span class="hljs-number">15</span>]<br><span class="hljs-keyword">let</span> state = <span class="hljs-title function_">some</span>(array, <span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item % <span class="hljs-number">2</span> === <span class="hljs-number">0</span>)<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(state)<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h3><ul>
<li>闭包(Closure): 函数和其周围的状态（语法环境）的引用捆绑在一起形成的闭包。</li>
<li>可以在另一个作用域中调用一个函数的内部函数并访问到该函数的作用域中的成员。<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 函数作为返回值</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">makeFn</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">let</span> msg = <span class="hljs-string">&#x27;Hello function&#x27;</span><br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(msg)<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">const</span> fn = <span class="hljs-title function_">makeFn</span>()<br><span class="hljs-title function_">fn</span>()<br><br><span class="hljs-comment">// once 只被执行一次</span><br><span class="hljs-keyword">let</span> <span class="hljs-title function_">once</span> = (<span class="hljs-params">fn</span>) =&gt; &#123;<br>  <span class="hljs-keyword">let</span> done = <span class="hljs-literal">false</span><br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">...rest</span>) &#123;<br>    <span class="hljs-keyword">if</span>(!done) &#123;<br>      done = <span class="hljs-literal">true</span><br>      fn.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, rest)<br>    &#125;<br>  &#125;<br>&#125;<br><span class="hljs-keyword">let</span> pay = <span class="hljs-title function_">once</span>(<span class="hljs-function"><span class="hljs-params">money</span> =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`成功支付￥<span class="hljs-subst">$&#123;money&#125;</span> RMB`</span>)<br>&#125;)<br><span class="hljs-title function_">pay</span>(<span class="hljs-number">5</span>);<br><span class="hljs-title function_">pay</span>(<span class="hljs-number">5</span>);<br><span class="hljs-title function_">pay</span>(<span class="hljs-number">5</span>);<br><br></code></pre></td></tr></table></figure></li>
<li>闭包的本质：函数在执行的时候会放到一个执行栈上，当函数执行完毕之后会从执行栈上移出，但是<strong>栈上的作用域成员因为被外部引用，所以不能释放</strong>，因此内部函数依然可以访问外部函数的成员</li>
</ul>
<h3 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 计算幂</span><br></code></pre></td></tr></table></figure>

<h2 id="纯函数-Pure-functions"><a href="#纯函数-Pure-functions" class="headerlink" title="纯函数 Pure functions"></a>纯函数 Pure functions</h2><ul>
<li><strong>相同的输入永远会得到相同的输出</strong>，而且没有任何可观察的副作用</li>
<li>纯函数就是类数学中的函数(用来描述输入和输出之间的关系)，y &#x3D; f(x)</li>
<li>lodash 是一个纯函数的功能库，提供了对数组、数字、字符串和函数等操作的一些方法</li>
<li>数组中的 <code>slice</code> 和 <code>splice</code> 分别是纯函数和非纯函数<ul>
<li><code>slice</code> 返回数组中指定的部分，不会改变原数组</li>
<li><code>splice</code> 对数组进行操作返回该数组，会改变原数组<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> arr = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>]<br><span class="hljs-comment">//纯函数</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>)) <span class="hljs-comment">// [ 1, 2 ]</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>)) <span class="hljs-comment">// [ 1, 2 ]</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>)) <span class="hljs-comment">// [ 1, 2 ]</span><br><br><span class="hljs-comment">//非纯函数</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr.<span class="hljs-title function_">splice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>)) <span class="hljs-comment">// [ 1, 2 ]</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr.<span class="hljs-title function_">splice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>)) <span class="hljs-comment">// [ 3, 4 ]</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr.<span class="hljs-title function_">splice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>)) <span class="hljs-comment">// [ 5, 6 ]</span><br></code></pre></td></tr></table></figure></li>
</ul>
</li>
<li>函数式编程不会保留计算中间的结果，所以变量是不可以变的(无状态的)</li>
<li>我们可以把一个函数的执行结果交给另一个函数去处理</li>
</ul>
<h3 id="Lodash"><a href="#Lodash" class="headerlink" title="Lodash"></a>Lodash</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 演示 lodash - first / last / toUpper / reverse / each / includes / find / findIndex</span><br><span class="hljs-keyword">const</span> _ = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;lodash&#x27;</span>)<br><span class="hljs-keyword">const</span> array = [<span class="hljs-string">&#x27;jack&#x27;</span>, <span class="hljs-string">&#x27;tom&#x27;</span>, <span class="hljs-string">&#x27;rose&#x27;</span>, <span class="hljs-string">&#x27;kate&#x27;</span>]<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(_.<span class="hljs-title function_">first</span>(array))<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(_.<span class="hljs-title function_">last</span>(array))<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(_.<span class="hljs-title function_">toUpper</span>(_.<span class="hljs-title function_">first</span>(array)))<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(_.<span class="hljs-title function_">reverse</span>(array))<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(_.<span class="hljs-title function_">each</span>(array, <span class="hljs-function">(<span class="hljs-params">item, index</span>) =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(item, index)<br>&#125;))<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(_.<span class="hljs-title function_">includes</span>(array, <span class="hljs-string">&#x27;jack&#x27;</span>))<br><span class="hljs-comment">// console.log(_.find(array, &#x27;jack&#x27;))</span><br><span class="hljs-comment">// console.log(_.includes(array, &#x27;jack&#x27;))</span><br></code></pre></td></tr></table></figure>

<h3 id="纯函数的优势"><a href="#纯函数的优势" class="headerlink" title="纯函数的优势"></a>纯函数的优势</h3><ul>
<li><p>可缓存：</p>
<ul>
<li>因为纯函数对相同的输入始终有相同的结果，所以可以把纯函数的结果缓存起来<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> _ = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;lodash&#x27;</span>)<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">getArea</span> (r) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(r)<br>  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * r * r<br>&#125;<br><span class="hljs-keyword">let</span> getAreaWithMemory = _.<span class="hljs-title function_">memoize</span>(getArea)<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">getAreaWithMemory</span>(<span class="hljs-number">4</span>))<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">getAreaWithMemory</span>(<span class="hljs-number">4</span>))<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">getAreaWithMemory</span>(<span class="hljs-number">4</span>))<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> 4 只打印了一次，第一次之后直接从缓存中读取</span><br><span class="hljs-comment"> 50.26548245743669</span><br><span class="hljs-comment"> 50.26548245743669</span><br><span class="hljs-comment"> 50.26548245743669</span><br><span class="hljs-comment"> */</span><br></code></pre></td></tr></table></figure>

<ul>
<li>模拟 memoize 的实现<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">memoize</span>(<span class="hljs-params">fn</span>) &#123;<br>  <span class="hljs-keyword">let</span> cache = &#123;&#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">...area</span>) &#123;<br>    <span class="hljs-keyword">let</span> key = <span class="hljs-string">`<span class="hljs-subst">$&#123;area&#125;</span>`</span><br>    cache[key] = cache[key] || <span class="hljs-title function_">fn</span>(...area)<br>    <span class="hljs-keyword">return</span> cache[key]<br>  &#125;<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">getArea</span> (r) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(r)<br>  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * r * r<br>&#125;<br><span class="hljs-keyword">let</span> getAreaWithMemory = <span class="hljs-title function_">memoize</span>(getArea)<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">getAreaWithMemory</span>(<span class="hljs-number">4</span>))<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">getAreaWithMemory</span>(<span class="hljs-number">4</span>))<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">getAreaWithMemory</span>(<span class="hljs-number">4</span>))<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
<li><p>可测试：</p>
<ul>
<li>纯函数让测试更方便</li>
</ul>
</li>
<li><p>并行处理：</p>
<ul>
<li>在多线程环境下并行操作共享的内存数据很可能出现意外情况</li>
<li>纯函数不需要访问共享的内存数据，所以在并行环境下可以任意运行纯函数 (Web Worker 可以开启多线程)</li>
</ul>
</li>
</ul>
<h3 id="函数的副作用"><a href="#函数的副作用" class="headerlink" title="函数的副作用"></a>函数的副作用</h3><ul>
<li>纯函数：对于相同的输入永远会得到相同的输出，而且没有任何可观察的<strong>副作用</strong><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 非纯函数</span><br><span class="hljs-keyword">let</span> min = <span class="hljs-number">18</span> <span class="hljs-comment">// mini 是外部可变的，所以影响了纯函数的原则</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">checkAge</span> (age) &#123;<br>  <span class="hljs-keyword">return</span> age &gt;= min;<br>&#125;<br><br><span class="hljs-comment">// 纯函数(有硬编码，后续可以通过柯里化解决)</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">checkAge</span> (age) &#123;<br>  <span class="hljs-keyword">let</span> min = <span class="hljs-number">18</span><br>  <span class="hljs-keyword">return</span> age &gt;= min<br>&#125;<br></code></pre></td></tr></table></figure>
副作用让一个函数变得不纯(如上例)，纯函数的根据相同的输入返回相同的输出，如果函数依赖外部状态就无法保证相同输出，就会带来副作用</li>
</ul>
<p>大部分的副作用来源于：</p>
<ul>
<li>配置文件</li>
<li>数据库</li>
<li>获取用户输入</li>
<li>……<br>所有的外部交互都有可能代理副作用，副作用也使得方法的通用性下降不适合扩展和可重用性，同时副作用会给程序中带来安全隐患和不确定性</li>
</ul>
<h2 id="柯里化-Haskell-Brooks-Curry"><a href="#柯里化-Haskell-Brooks-Curry" class="headerlink" title="柯里化 Haskell Brooks Curry"></a>柯里化 Haskell Brooks Curry</h2><p>使用柯里化解决程序中硬编码问题</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">checkAge</span> (age) &#123;<br>  <span class="hljs-keyword">let</span> min = <span class="hljs-number">18</span><br>  <span class="hljs-keyword">return</span> age &gt;= min<br>&#125;<br><br><span class="hljs-comment">// 普通的纯函数</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">checkAge</span>(<span class="hljs-params">min, age</span>) &#123;<br>  <span class="hljs-keyword">return</span> age &gt;= min<br>&#125;<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">checkAge</span>(<span class="hljs-number">18</span>, <span class="hljs-number">20</span>))<br><br><span class="hljs-comment">// 柯里化纯函数</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">checkAge</span> (min) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">age</span>) &#123;<br>    <span class="hljs-keyword">return</span> age &gt;= min<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">//  柯里化ES6写法</span><br><span class="hljs-keyword">let</span> <span class="hljs-title function_">checkAge</span> = min =&gt; (<span class="hljs-function"><span class="hljs-params">age</span> =&gt;</span> age &gt;= min)<br><br><span class="hljs-keyword">const</span> checkAge18 = <span class="hljs-title function_">checkAge</span>(<span class="hljs-number">18</span>)<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">checkAge18</span>(<span class="hljs-number">20</span>))<br><span class="hljs-keyword">const</span> checkAge20 = <span class="hljs-title function_">checkAge</span>(<span class="hljs-number">20</span>)<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">checkAge20</span>(<span class="hljs-number">18</span>))<br></code></pre></td></tr></table></figure>

<ul>
<li>柯里化<ul>
<li>当函数有多个参数需要传递的时候先传递一部分调用它(这部分参数以后永远不变)</li>
<li>然后返回一个新函数接收剩余参数，返回结果</li>
</ul>
</li>
</ul>
<h3 id="lodash-中的柯里化"><a href="#lodash-中的柯里化" class="headerlink" title="lodash 中的柯里化"></a>lodash 中的柯里化</h3><ul>
<li><code>_.curry(func)</code><ul>
<li>功能：创建一个函数，该函数接收一个或多个func的参数，如果 func 所需参数都被传入，则会立即执行并返回结果。如果传递的参数这是 func 所需参数的一部分，那它会返回一个函数用来接收剩余参数</li>
<li>参数：需要柯里化的函数</li>
<li>返回值：柯里化后的函数</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> <span class="hljs-title function_">getSum</span> = (<span class="hljs-params">a, b, c</span>) =&gt; &#123;<br>  <span class="hljs-keyword">return</span> a + b + c<br>&#125;<br><br><span class="hljs-keyword">let</span> getSumCurried = _.<span class="hljs-title function_">curry</span>(getSum)<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">getSumCurried</span>(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>))  <span class="hljs-comment">// 传递所有参数时，会立即调用并返回结果</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">getSumCurried</span>(<span class="hljs-number">1</span>)(<span class="hljs-number">2</span>,<span class="hljs-number">3</span>)) <span class="hljs-comment">// 如果传递的并不是该函数的所有参数，那它会返回一个函数等待接收剩下的参数</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">getSumCurried</span>(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>)(<span class="hljs-number">3</span>))<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">getSumCurried</span>(<span class="hljs-number">1</span>)(<span class="hljs-number">2</span>)(<span class="hljs-number">3</span>))<br><br></code></pre></td></tr></table></figure>

<ul>
<li><p>学习案例</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;&#x27;</span>.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/\+/g</span>))<br><br><span class="hljs-keyword">let</span> match = _.<span class="hljs-title function_">curry</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">reg, str</span>) &#123;<br>  <span class="hljs-keyword">return</span> str.<span class="hljs-title function_">match</span>(reg)<br>&#125;)<br><br><span class="hljs-keyword">const</span> haveSpace = <span class="hljs-title function_">match</span>(<span class="hljs-regexp">/\s+/g</span>)<br><span class="hljs-keyword">const</span> haveNumber = <span class="hljs-title function_">match</span>(<span class="hljs-regexp">/\d+/g</span>)<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">haveSpace</span>(<span class="hljs-string">&#x27;hello world&#x27;</span>))<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">haveNumber</span>(<span class="hljs-string">&#x27;123abc&#x27;</span>))<br><br><span class="hljs-keyword">const</span> filter = _.<span class="hljs-title function_">curry</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">fn, array</span>) &#123;<br>  <span class="hljs-keyword">return</span> array.<span class="hljs-title function_">filter</span>(fn)<br>&#125;)<br><br><span class="hljs-keyword">let</span> haveSpaceFn = <span class="hljs-title function_">filter</span>(haveSpace);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">haveSpaceFn</span>([<span class="hljs-string">&#x27;gu1 yun&#x27;</span>, <span class="hljs-string">&#x27;ho_wei&#x27;</span>]))<br></code></pre></td></tr></table></figure>
</li>
<li><p>总结<br>柯里化的操是将函数的参数先传递一本分给函数，剩下的参数传递给返回的参数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> haveSpace = <span class="hljs-title function_">match</span>(<span class="hljs-regexp">/\s+/g</span>)<br><span class="hljs-keyword">const</span> haveNumber = <span class="hljs-title function_">match</span>(<span class="hljs-regexp">/\d+/g</span>)<br><br><span class="hljs-comment">// 自己通过柯里化改造函数</span><br><span class="hljs-keyword">const</span> filter = <span class="hljs-keyword">function</span> (<span class="hljs-params">fn</span>) &#123;<br>  <span class="hljs-comment">// fn: 使用的工具函数</span><br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">array</span>) &#123;<br>    <span class="hljs-comment">// array: 需要使用到的数据</span><br>    <span class="hljs-keyword">return</span> array.<span class="hljs-title function_">filter</span>(fn)<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">const</span> haveSpaceCurry = <span class="hljs-title function_">filter</span>(haveSpace)<br><span class="hljs-comment">// ES6</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">filter</span> = fn =&gt; (<span class="hljs-function"><span class="hljs-params">array</span> =&gt;</span> array.<span class="hljs-title function_">filter</span>(fn))<br><br><span class="hljs-comment">// lodash 提供的柯里化方法</span><br><span class="hljs-keyword">const</span> filter = _.<span class="hljs-title function_">curry</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">fn, array</span>) &#123;<br>  <span class="hljs-keyword">return</span> array.<span class="hljs-title function_">filter</span>(fn)<br>&#125;)<br><span class="hljs-comment">// lodash 的 curry 方法可以吧一个普通的函数编程柯里化函数</span><br><span class="hljs-comment">// 最终的目标是将函数变成一元函数</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="柯里化实现原理"><a href="#柯里化实现原理" class="headerlink" title="柯里化实现原理"></a>柯里化实现原理</h3><p>模拟实现 lodash 中的 curry 方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">getSum</span> (a, b, c) &#123;<br>  <span class="hljs-keyword">return</span> a + b + c<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">curry</span> (fn) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">curriedFn</span> (...args) &#123;<br>    <span class="hljs-keyword">if</span>(args.<span class="hljs-property">length</span> &lt; fn.<span class="hljs-property">length</span> ) &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_">curriedFn</span>(...args.<span class="hljs-title function_">concat</span>(<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">form</span>(<span class="hljs-variable language_">arguments</span>)))        <br>      &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">fn</span>(...args)<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">const</span> curried = <span class="hljs-title function_">curry</span>(getSum)<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">curried</span>(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>))<br></code></pre></td></tr></table></figure>

<h3 id="柯里化总结"><a href="#柯里化总结" class="headerlink" title="柯里化总结"></a>柯里化总结</h3><ul>
<li>柯里化可以我们给一个函数传递较少的参数，得到一个已经记录了某个固定参数的新函数</li>
<li>这是一种函数对参数的缓存</li>
<li>让函数变得更灵活，让函数的颗粒度更小</li>
<li>可以把多元函数转换成一元函数，可以组合使用函数产生强大的功能</li>
</ul>
<h2 id="函数组合"><a href="#函数组合" class="headerlink" title="函数组合"></a>函数组合</h2><p>使用纯函数和柯里化很容易写出洋葱代码 <code>a(b(c(d)))</code></p>
<ul>
<li>获取数组的最后一个元素再转换成大写字母 <code>_.toUpper(_.first(_.reverse(array)))</code><br>函数组合可以让我们把细粒度的函数重新组合成一个新的函数</li>
</ul>
<h3 id="管道"><a href="#管道" class="headerlink" title="管道"></a>管道</h3><p>下面这张图表示程序中使用函数处理数据的过程，给 n 函数输入参数 a，返回结果 b,可以想想 a 通过一个管道得到了 b 的数据</p>
<img src="/2021/07/21/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/img.png" srcset="/img/loading.gif" lazyload class="">
<p>当fn比较复杂的时候，我们可以把函数 fn 拆分成多个小函数，此时多了中间运算过程产生的 m 和 n。</p>
<p>下面这张图可以想象成把 fn 这个管道拆分成3个管道 f1 f2 f3，数据 a 通过管道 f3 得到结果 m，m 再通过管道 f2 得到结果 n，n 通过管道 f1 得到最终结果 b</p>
<img src="/2021/07/21/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/img_1.png" srcset="/img/loading.gif" lazyload class="">
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs javascript">fn = <span class="hljs-title function_">compose</span>(f1, f2, f3)<br>b = <span class="hljs-title function_">fn</span>(a)<br></code></pre></td></tr></table></figure>
<p><code>commpose</code> 就相当于是一个管道，它把三个函数组合成一个函数<code>fn</code>，调用 <code>fn</code> 返回结果<code>b</code>，实际上这个数据是由<code>f1、f2、f3</code>三个函数处理的，在它们处理时就会产生<code>m、n</code>等结果，对于这些结果我们并不需要关心</p>
<h3 id="函数组合-1"><a href="#函数组合-1" class="headerlink" title="函数组合"></a>函数组合</h3><ul>
<li>函数组合 (Compose): 如果一个函数要经过多个函数处理才能得到最终值，这个时候可以把中间过程的处理函数合并成一个函数<ul>
<li>函数就是处理数据的管道，函数组合就是把这些管道链接，让数据穿过多个管道得到最终的结果</li>
<li><strong>函数组合默认是从右到左执行</strong><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">//  函数组合</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">compose</span>(<span class="hljs-params">f, g</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">value</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">f</span>(<span class="hljs-title function_">g</span>(value))<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">reverse</span>(<span class="hljs-params">array</span>) &#123;<br>  <span class="hljs-keyword">return</span> array.<span class="hljs-title function_">reverse</span>()<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">first</span>(<span class="hljs-params">array</span>) &#123;<br>  <span class="hljs-keyword">return</span> array[<span class="hljs-number">0</span>]<br>&#125;<br><br><span class="hljs-keyword">const</span> last = <span class="hljs-title function_">compose</span>(first, reverse)<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">last</span>([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>])) <span class="hljs-comment">// 4</span><br></code></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="lodash-中的组合函数"><a href="#lodash-中的组合函数" class="headerlink" title="lodash 中的组合函数"></a>lodash 中的组合函数</h3><p>lodash 中组合函数 <code>flow()</code> 或者 <code>flowRight()</code>，它们都可以组合多个函数</p>
<ul>
<li><code>flow()</code>从左到右执行</li>
<li><code>flowRight()</code>从右到左执行(常用)<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> _ = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;lodash&#x27;</span>)<br><br><span class="hljs-keyword">let</span> arr = [<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;d&#x27;</span>]<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">reverse</span> = array =&gt; array.<span class="hljs-title function_">reverse</span>()<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">first</span> = array =&gt; array[<span class="hljs-number">0</span>]<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">toUpper</span> = value =&gt;  value.<span class="hljs-title function_">toUpperCase</span>()<br><br><span class="hljs-keyword">const</span> f = _.<span class="hljs-title function_">flowRight</span>(toUpper, first, reverse)<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">f</span>(arr)) <span class="hljs-comment">// D</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="组合函数的实现原理"><a href="#组合函数的实现原理" class="headerlink" title="组合函数的实现原理"></a>组合函数的实现原理</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> _ = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;lodash&#x27;</span>)<br><br><span class="hljs-keyword">let</span> arr = [<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;d&#x27;</span>, <span class="hljs-string">&#x27;e&#x27;</span>]<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">reverse</span> = array =&gt; array.<span class="hljs-title function_">reverse</span>()<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">first</span> = array =&gt; array[<span class="hljs-number">0</span>]<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">toUpper</span> = value =&gt;  value.<span class="hljs-title function_">toUpperCase</span>()<br><br><span class="hljs-comment">// 使用 lodash 中的组合函数</span><br><span class="hljs-keyword">const</span> f = _.<span class="hljs-title function_">flowRight</span>(toUpper, first, reverse)<br><br><span class="hljs-comment">// --------------------------------------------------------------------</span><br><br><span class="hljs-comment">// 自定义组合函数</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">compose</span> (...args) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">value</span>) &#123;<br>    <span class="hljs-keyword">return</span> args.<span class="hljs-title function_">reverse</span>().<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">count, fn</span>) =&gt;</span> <span class="hljs-title function_">fn</span>(count), value)<br>  &#125;<br>&#125;<br><span class="hljs-comment">// es6 版本</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">compose</span> = (<span class="hljs-params">...args</span>) =&gt; <span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> args.<span class="hljs-title function_">reverse</span>().<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, fn</span>) =&gt;</span> <span class="hljs-title function_">fn</span>(acc), value)<br><br><span class="hljs-keyword">const</span> f = <span class="hljs-title function_">compose</span>(toUpper, first, reverse)<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">f</span>(arr)) <span class="hljs-comment">// E</span><br></code></pre></td></tr></table></figure>

<h2 id="组合律"><a href="#组合律" class="headerlink" title="组合律"></a>组合律</h2><p>函数组合要满足**组合率(associativity)**，我们可以把 g 和 h 组合，还可以把 f 和 g 组合，结果都是一样的</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 组合律 (associativity)</span><br><span class="hljs-keyword">let</span> f = <span class="hljs-title function_">compose</span>(f, g, h)<br><span class="hljs-keyword">let</span> associactive = <span class="hljs-title function_">compose</span>(<span class="hljs-title function_">compose</span>(f, g), h) == <span class="hljs-title function_">compose</span>(f, <span class="hljs-title function_">compose</span>(g, h)) <span class="hljs-comment">// true</span><br><br><span class="hljs-comment">// --------------------------------------------------------------------</span><br><br><span class="hljs-keyword">const</span> _ = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;lodash&#x27;</span>)<br><br><span class="hljs-keyword">let</span> arr = [<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;d&#x27;</span>, <span class="hljs-string">&#x27;e&#x27;</span>]<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">reverse</span> = array =&gt; array.<span class="hljs-title function_">reverse</span>()<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">first</span> = array =&gt; array[<span class="hljs-number">0</span>]<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">toUpper</span> = value =&gt;  value.<span class="hljs-title function_">toUpperCase</span>()<br><br><span class="hljs-comment">// const f = _.flowRight(_.flowRight(_.toUpper, _.first), _.reverse)</span><br><span class="hljs-keyword">const</span> f = _.<span class="hljs-title function_">flowRight</span>(_.<span class="hljs-property">toUpper</span>, _.<span class="hljs-title function_">flowRight</span>(_.<span class="hljs-property">first</span>, _.<span class="hljs-property">reverse</span>))<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">f</span>(arr ))<br></code></pre></td></tr></table></figure>

<h2 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h2><p>辅助函数来调试打印组合函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><br><span class="hljs-comment">// 将 NEVER SAY DIE 处理为 never-say-die</span><br><span class="hljs-keyword">const</span> _ = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;lodash&#x27;</span>)<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">log</span> = v =&gt; &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(v)<br>  <span class="hljs-keyword">return</span> v<br>&#125;<br><br><span class="hljs-keyword">const</span> trace = _.<span class="hljs-title function_">curry</span>(<span class="hljs-function">(<span class="hljs-params">tag, v</span>) =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(tag, v)<br>  <span class="hljs-keyword">return</span> v<br>&#125;)<br><br><span class="hljs-comment">// 通过封装将这些函数变为一元函数</span><br><span class="hljs-keyword">const</span> split = _.<span class="hljs-title function_">curry</span>(<span class="hljs-function">(<span class="hljs-params">sep, str</span>) =&gt;</span> _.<span class="hljs-title function_">split</span>(str, sep))<br><span class="hljs-keyword">const</span> map = _.<span class="hljs-title function_">curry</span>(<span class="hljs-function">(<span class="hljs-params">fn, array</span>) =&gt;</span> _.<span class="hljs-title function_">map</span>(array, fn))<br><span class="hljs-keyword">const</span> join = _.<span class="hljs-title function_">curry</span>(<span class="hljs-function">(<span class="hljs-params">sep, array</span>) =&gt;</span> _.<span class="hljs-title function_">join</span>(array, sep))<br><span class="hljs-comment">// 使用 log 辅助函数将当前进度时的值进行打印，但有一个问题是不能区分打印的具体位置</span><br><span class="hljs-comment">// const compose = _.flowRight(join(&#x27;-&#x27;),log, map(_.toLower),log, split(&#x27; &#x27;))</span><br><span class="hljs-keyword">const</span> compose = _.<span class="hljs-title function_">flowRight</span>(<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27;-&#x27;</span>),<span class="hljs-title function_">trace</span>(<span class="hljs-string">&#x27;这是 map 之后&#x27;</span>), <span class="hljs-title function_">map</span>(_.<span class="hljs-property">toLower</span>),<span class="hljs-title function_">trace</span>(<span class="hljs-string">&#x27;这是 split 之后&#x27;</span>), <span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27; &#x27;</span>))<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">compose</span>(<span class="hljs-string">&#x27;NEVER SAY DIE&#x27;</span>))<br></code></pre></td></tr></table></figure>

<h2 id="Lodash-中的-FP-Functional-Programming-模块"><a href="#Lodash-中的-FP-Functional-Programming-模块" class="headerlink" title="Lodash 中的 FP(Functional Programming) 模块"></a>Lodash 中的 FP(Functional Programming) 模块</h2><p>lodash&#x2F;fp</p>
<ul>
<li>lodash 的 fp 模块提供了实用的<strong>对函数式编程的友好</strong>的方法</li>
<li>提供了不可变的、已经被柯里化的且具有<strong>auto-curried、iteratee-first、data-list</strong>等特点的方法<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><br><span class="hljs-comment">// lodash 模块中的方法和 FP 模块中方法的区别</span><br><span class="hljs-keyword">const</span> array = [<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>]<br><span class="hljs-comment">//  lodash - 数据优先，回调、操作往后排</span><br><span class="hljs-keyword">const</span> _ = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;lodash&#x27;</span>)<br>_.<span class="hljs-title function_">map</span>(array, _.<span class="hljs-property">toUpper</span>) <span class="hljs-comment">// [ &#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27; ]</span><br>_.<span class="hljs-title function_">map</span>(array) <span class="hljs-comment">// [ &#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27; ]</span><br>_.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;hello world&#x27;</span>, <span class="hljs-string">&#x27; &#x27;</span>) <span class="hljs-comment">// [ &#x27;hello&#x27;, &#x27;world&#x27; ]</span><br><br><span class="hljs-comment">// lodash/fp 模块 - 方法优先，已经是被柯里化的函数</span><br><span class="hljs-keyword">const</span> fp = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;lodash/fp&#x27;</span>)<br><br>fp.<span class="hljs-title function_">map</span>(fp.<span class="hljs-property">toUpper</span>, array)<br>fp.<span class="hljs-title function_">map</span>(fp.<span class="hljs-property">toUpper</span>)(array)<br><br>fp.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27; &#x27;</span>, <span class="hljs-string">&#x27;hello world&#x27;</span>)<br>fp.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27; &#x27;</span>)(<span class="hljs-string">&#x27;hello world&#x27;</span>)<br></code></pre></td></tr></table></figure></li>
</ul>
<p>lodash 和 lodash&#x2F;fp 模块中 map 方法的区别</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// lodash 和 lodash/fp 模块中 map 方法的区别</span><br>  <span class="hljs-keyword">const</span> _ = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;lodash&#x27;</span>)<br><br>  <span class="hljs-keyword">const</span> array = [<span class="hljs-string">&#x27;23&#x27;</span>, <span class="hljs-string">&#x27;8&#x27;</span>, <span class="hljs-string">&#x27;10&#x27;</span>]<br><br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(_.<span class="hljs-title function_">map</span>(array, <span class="hljs-built_in">parseInt</span>)) <span class="hljs-comment">// [ 23, NaN, 2 ]</span><br>  <span class="hljs-comment">// lodash 中 map 方法的parseInt回调会要求三个参数：当前处理元素：&#x27;23&#x27; 下标：&#x27;0&#x27; 集合：array</span><br><br>  <span class="hljs-keyword">const</span> fp = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;lodash/fp&#x27;</span>)<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fp.<span class="hljs-title function_">map</span>(<span class="hljs-built_in">parseInt</span>, array)) <span class="hljs-comment">// [ 23, 8, 10 ]</span><br>  <span class="hljs-comment">// fp 模块中的 map 方法的parseInt回调只要求一个当前处理元素的参数</span><br></code></pre></td></tr></table></figure>

<h2 id="PointFree"><a href="#PointFree" class="headerlink" title="PointFree"></a>PointFree</h2><p><strong>PointFree:</strong> 我们可以把数据处理的过程定义成与数据无关的合成运算，不需要用到代表数组的那个参数，只要把简单的运算步骤合成到一起，在使用这种模式之前我们需要定义一些辅助的基本运算函数</p>
<ul>
<li>合并时不需要指明处理的数据</li>
<li><strong>只需要合成运算过程</strong></li>
<li>需要定义一些辅助的基本运算函数<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// Point Free 模式其实就是函数的组合</span><br><span class="hljs-keyword">const</span> f = fp.<span class="hljs-title function_">flowRight</span>(fp.<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27;-&#x27;</span>), fp.<span class="hljs-title function_">map</span>(fp.<span class="hljs-property">toLower</span>), fp.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27; &#x27;</span>))<br></code></pre></td></tr></table></figure></li>
</ul>
<p>来吧，展示</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 把一个字符串中的首字母提取并转换为大写，使用&quot;.&quot;作为分隔符号</span><br><span class="hljs-comment">// world wild web ==&gt; W.W.W</span><br><span class="hljs-keyword">const</span> fp = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;lodash/fp&#x27;</span>)<br><span class="hljs-comment">// const firstLetterToUpper = fp.flowRight(fp.join(&#x27;.&#x27;), fp.map(fp.first), fp.map(fp.toUpper), fp.split(&#x27; &#x27;)) // 遍历两次</span><br><span class="hljs-keyword">const</span> firstLetterToUpper = fp.<span class="hljs-title function_">flowRight</span>(fp.<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27;.&#x27;</span>), fp.<span class="hljs-title function_">map</span>(fp.<span class="hljs-title function_">flowRight</span>(fp.<span class="hljs-property">first</span>, fp.<span class="hljs-property">toUpper</span>)), fp.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27; &#x27;</span>))<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">firstLetterToUpper</span>(<span class="hljs-string">&#x27;world wild web&#x27;</span>))<br></code></pre></td></tr></table></figure>

<h2 id="函子"><a href="#函子" class="headerlink" title="函子"></a>函子</h2><p>函子的作用是帮助我们将副作用控制在可控的范围内、异常处理、异步操作等。</p>
<h3 id="Functor-函子"><a href="#Functor-函子" class="headerlink" title="Functor 函子"></a>Functor 函子</h3><p>什么是 functor</p>
<ul>
<li>容器：包含值和值的变形关系(这个变形关系就是函数)</li>
<li>函子：是一个特殊的容器，通过一个普通的对象来实现，该对象具有 map 方法，map 方法可以运行一个函数对值进行处理(变形关系)  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Container</span> &#123;<br>  <span class="hljs-title function_">constructor</span> (value) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_value</span> = value<br>  &#125;<br>  <span class="hljs-keyword">static</span> <span class="hljs-keyword">of</span> (value) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Container</span>(value)<br>  &#125;<br>  map (fn) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Container</span>.<span class="hljs-title function_">of</span>(<span class="hljs-title function_">fn</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">_value</span>))<br>  &#125;<br>&#125;<br><span class="hljs-keyword">let</span> r = <span class="hljs-title class_">Container</span>.<span class="hljs-title function_">of</span>(<span class="hljs-number">5</span>)<br>  .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x + <span class="hljs-number">2</span>)<br>  .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x * x)<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(r)<br><br><span class="hljs-keyword">let</span> upper = <span class="hljs-title class_">Container</span>.<span class="hljs-title function_">of</span>(<span class="hljs-literal">null</span>)<br>  .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x.<span class="hljs-title function_">toUpperCase</span>()) <span class="hljs-comment">// 会报错，函子处理 null/undefined 等空值是会报错，需要使用 MayBe 函子来处理（下个小节）</span><br><br></code></pre></td></tr></table></figure></li>
<li>总结<ul>
<li>函数式编程的运算不直接操作值，而是由函子完成</li>
<li>函子就是一个实现了 map 的契约对象</li>
<li>我们可以把函子想象成一个盒子，这个盒子里封装了一个值</li>
<li>想要处理盒子中的值，我们需要给盒子的 map 方法传递一个处理值得函数(纯函数)，由这个函数对这个值进行处理</li>
<li>最终 map 方法返回一个包含新值得盒子(函子)</li>
</ul>
</li>
</ul>
<h3 id="MayBe-函子"><a href="#MayBe-函子" class="headerlink" title="MayBe 函子"></a>MayBe 函子</h3><p>我们在编程过程中可能会遇到很多错误，需要对相应的错误做相应的处理，<code>MayBe</code> 函子的作用就是对外部的空值情况做处理(控制副作用在允许的范围内)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MayBe</span> &#123;<br>    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">value</span>) &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_value</span> = value<br>    &#125;<br><br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">of</span> (value) &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MayBe</span>(value)<br>    &#125;<br><br>    isNothing () &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_value</span> === <span class="hljs-literal">null</span> || <span class="hljs-variable language_">this</span>.<span class="hljs-property">_value</span> === <span class="hljs-literal">undefined</span><br>    &#125;<br><br>    <span class="hljs-title function_">map</span>(<span class="hljs-params">fn</span>) &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">isNothing</span>() ? <span class="hljs-title class_">MayBe</span>.<span class="hljs-title function_">of</span>(<span class="hljs-literal">null</span>) : <span class="hljs-title class_">MayBe</span>.<span class="hljs-title function_">of</span>(<span class="hljs-title function_">fn</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">_value</span>))<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-comment">// let r = MayBe.of(&#x27;hello&#x27;)</span><br>  <span class="hljs-comment">//   .map(x =&gt; x.toUpperCase())</span><br>  <span class="hljs-comment">// console.log(r) // 正常执行</span><br><br>  <span class="hljs-keyword">let</span> r = <span class="hljs-title class_">MayBe</span>.<span class="hljs-title function_">of</span>(<span class="hljs-literal">null</span>)<br>    .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x.<span class="hljs-title function_">toUpperCase</span>())<br><br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(r) <span class="hljs-comment">// MayBe &#123; _value: null &#125; 传递 null 也不会报错</span><br><br>  <span class="hljs-comment">// </span><br>  <span class="hljs-keyword">let</span> r = <span class="hljs-title class_">MayBe</span>.<span class="hljs-title function_">of</span>(<span class="hljs-string">&#x27;hello&#x27;</span>)<br>    .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x.<span class="hljs-title function_">toUpperCase</span>())<br>    .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> <span class="hljs-literal">null</span>)<br>    .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x + <span class="hljs-string">&#x27; world&#x27;</span>)<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(r) <span class="hljs-comment">// MayBe &#123; _value: null &#125;</span><br><br>  <span class="hljs-comment">// 返回值为null</span><br></code></pre></td></tr></table></figure>
<p>但其实还存在一个问题，当我们调用多个函子时，如果其中某一个位置发生了异常，是没有办法精确捕捉到的</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MayBe</span> &#123;<br>    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">value</span>) &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_value</span> = value<br>    &#125;<br><br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">of</span> (value) &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MayBe</span>(value)<br>    &#125;<br><br>    isNothing () &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_value</span> === <span class="hljs-literal">null</span> || <span class="hljs-variable language_">this</span>.<span class="hljs-property">_value</span> === <span class="hljs-literal">undefined</span><br>    &#125;<br><br>    <span class="hljs-title function_">map</span>(<span class="hljs-params">fn</span>) &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">isNothing</span>() ? <span class="hljs-title class_">MayBe</span>.<span class="hljs-title function_">of</span>(<span class="hljs-literal">null</span>) : <span class="hljs-title class_">MayBe</span>.<span class="hljs-title function_">of</span>(<span class="hljs-title function_">fn</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">_value</span>))<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-keyword">let</span> r = <span class="hljs-title class_">MayBe</span>.<span class="hljs-title function_">of</span>(<span class="hljs-string">&#x27;hello&#x27;</span>)<br>    .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x.<span class="hljs-title function_">toUpperCase</span>())<br>    .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> <span class="hljs-literal">null</span>)<br>    .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x + <span class="hljs-string">&#x27; world&#x27;</span>)<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(r) <span class="hljs-comment">// MayBe &#123; _value: null &#125;</span><br></code></pre></td></tr></table></figure>
<p>面对这种情况还是有解决的方法的</p>
<h3 id="Either"><a href="#Either" class="headerlink" title="Either"></a>Either</h3><p><code>Either</code> 是两个其中的任何一个，类似于 <code>if...else...</code> 的处理，异常会让函数变得不纯，<code>Either</code> 函数可以用来做异常处理</p>
<p>来吧，展示</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">//定义一个处理异常的函子</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Mistake</span> &#123;<br>  <span class="hljs-keyword">static</span> <span class="hljs-keyword">of</span> (value) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Mistake</span>(value)<br>  &#125;<br><br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">value</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_value</span> = value<br>  &#125;<br><br>  map (fn) &#123;<br>    <span class="hljs-comment">// 这里同于以往函子的的 map 方法</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span><br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// 定义一个正常执行的函子</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Right</span> &#123;<br>  <span class="hljs-keyword">static</span> <span class="hljs-keyword">of</span> (value) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Right</span>(value)<br>  &#125;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">value</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_value</span> = value<br>  &#125;<br><br>  <span class="hljs-title function_">map</span>(<span class="hljs-params">fn</span>) &#123;<br>    <span class="hljs-keyword">return</span>  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Right</span>(<span class="hljs-title function_">fn</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">_value</span>))<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// 通过 formatJSON 方法调用这两个函子</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">formatJSON</span> (json) &#123;<br>  <span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Right</span>.<span class="hljs-title function_">of</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(json))<br>  &#125; <span class="hljs-keyword">catch</span> (e) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Mistake</span>.<span class="hljs-title function_">of</span>(&#123;<span class="hljs-attr">error</span>: e.<span class="hljs-property">message</span>&#125;)<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// 传递错误参数，捕捉到异常，返回了错误信息</span><br><span class="hljs-comment">// let r = formatJSON(&#x27;&#123;name: zs&#125;&#x27;)</span><br><span class="hljs-comment">// console.log(r) // Mistake &#123; _value: &#123; error: &#x27;Unexpected token n in JSON at position 1&#x27; &#125;&#125;</span><br><br><span class="hljs-comment">// 正常执行</span><br><span class="hljs-keyword">let</span> r = <span class="hljs-title function_">formatJSON</span>(<span class="hljs-string">&#x27;&#123;&quot;name&quot;:&quot;zs&quot;&#125;&#x27;</span>)<br><span class="hljs-comment">// console.log(r) // Right &#123; _value: &#123; name: &#x27;zs&#x27; &#125; &#125;</span><br>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x.<span class="hljs-property">name</span>.<span class="hljs-title function_">toUpperCase</span>())<br><span class="hljs-comment">// console.log(r) // Right &#123; _value: &#x27;ZS&#x27; &#125;</span><br></code></pre></td></tr></table></figure>

<h3 id="IO-函子"><a href="#IO-函子" class="headerlink" title="IO 函子"></a>IO 函子</h3><p>IO函子中的 <code>_value</code> 是一个函数，这里是把函数作为值来处理。IO函子可以把不纯的动作存储到 <code>_value</code> 中，延迟执行这个不纯的操作(惰性执行)，包装当前的纯操作，把不纯的操作交个带调用者来处理</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> fp = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;lodash/fp&#x27;</span>)<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">IO</span> &#123;<br>  <span class="hljs-keyword">static</span> <span class="hljs-keyword">of</span> = <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> <span class="hljs-keyword">new</span> <span class="hljs-title function_">IO</span>(<span class="hljs-function">() =&gt;</span> value)<br><br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">fn</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_value</span> = fn<br>  &#125;<br><br>  map (fn) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title function_">IO</span>(fp.<span class="hljs-title function_">flowRight</span>(fn, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_value</span>))<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">let</span> r = <span class="hljs-variable constant_">IO</span>.<span class="hljs-title function_">of</span>(process).<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span> p.<span class="hljs-property">execPath</span>)<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(r.<span class="hljs-title function_">_value</span>())<br></code></pre></td></tr></table></figure>

<h3 id="Task-异步任务"><a href="#Task-异步任务" class="headerlink" title="Task 异步任务"></a>Task 异步任务</h3><p>异步任务实现比较复杂，这里使用 <code>floktale</code> 中的 <code>Task</code> 演示，[floktale](<a target="_blank" rel="noopener" href="https://www.floktale/">https://www.floktale</a> .com) 是一个标准的函数式编程库，和 <code>lodash、ramda</code>不同的是它没有提供很多功能函数，只提供了一些函数处理操作，例如：<code>compose、curry</code>等，一些函子 &#96;Task、Either、MayBe等</p>
<p>下面先演示一下 <code>floktale</code> 中的 <code>compose、curry</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> &#123; compose, curry &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;folktale/core/lambda&#x27;</span>)<br><span class="hljs-keyword">const</span> &#123; toUpper, first &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;lodash/fp&#x27;</span>)<br><br><span class="hljs-comment">// 第一个参数是要表明回调函数的参数个数，文档上讲是为了避免一些错误</span><br><span class="hljs-keyword">let</span> f = <span class="hljs-title function_">curry</span>(<span class="hljs-number">2</span>, <span class="hljs-function">(<span class="hljs-params">x, y</span>) =&gt;</span> x + y)<br><br><span class="hljs-comment">// console.log(f(1,2))</span><br><span class="hljs-comment">// console.log(f(1)(3))</span><br><br><span class="hljs-keyword">let</span> c = <span class="hljs-title function_">compose</span>(toUpper, first)<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">c</span>([<span class="hljs-string">&#x27;one&#x27;</span>, <span class="hljs-string">&#x27;two&#x27;</span>]))<br></code></pre></td></tr></table></figure>

<ul>
<li><code>Task</code> 异步执行<ul>
<li>folktale(2.3.2) 2.x 中的 Task 和 1.0 中的区别还是挺大的，1.0中的用法更接近我们现在演示的函子，这里使用 2.3.2 来演示<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">//  Task 函子</span><br><span class="hljs-keyword">const</span> &#123; task &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;folktale/concurrency/task&#x27;</span>)<br><span class="hljs-keyword">const</span> fs  = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>)<br><span class="hljs-keyword">const</span> &#123; split, find &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;lodash/fp&#x27;</span>)<br><br><span class="hljs-comment">// 返回一个 task 函子</span><br><span class="hljs-comment">// const readFile = filename =&gt; task(resolver =&gt; &#123;</span><br><span class="hljs-comment">//   fs.readFile(filename, &#x27;UTF-8&#x27;, (err, data) =&gt; &#123;</span><br><span class="hljs-comment">//     if(err) resolver.reject(err)</span><br><span class="hljs-comment">//     resolver.resolve(data)</span><br><span class="hljs-comment">//   &#125;)</span><br><span class="hljs-comment">// &#125;)</span><br><span class="hljs-comment">// 读取 package.json 文件找到version</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">readFile</span> (filename) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">task</span>(<span class="hljs-function"><span class="hljs-params">resolver</span> =&gt;</span> &#123;<br>    fs.<span class="hljs-title function_">readFile</span>(filename, <span class="hljs-string">&#x27;utf-8&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> &#123;<br>      <span class="hljs-keyword">if</span>(err) resolver.<span class="hljs-title function_">reject</span>(err)<br><br>      resolver.<span class="hljs-title function_">resolve</span>(data)<br>    &#125;)<br>  &#125;)<br>&#125;<br><br><span class="hljs-comment">// 找到文件后并不会读取</span><br><span class="hljs-title function_">readFile</span>(<span class="hljs-string">&#x27;package.json&#x27;</span>)<br>  .<span class="hljs-title function_">map</span>(<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;\n&#x27;</span>))<br>  .<span class="hljs-title function_">map</span>(<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;version&#x27;</span>)))<br>  <span class="hljs-comment">// 使用 run 方法读取文件</span><br>  .<span class="hljs-title function_">run</span>()<br>  .<span class="hljs-title function_">listen</span>(&#123;<br>    <span class="hljs-attr">onRejected</span>: <span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(err),<br>    <span class="hljs-attr">onResolved</span>: <span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(value)<br>  &#125;)<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="Pointed-函子"><a href="#Pointed-函子" class="headerlink" title="Pointed 函子"></a>Pointed 函子</h3><p><code>Pointed</code> 函子是实现了 of 静态方法的函子，of 方法是为了避免使用 <code>new</code> 来创建对象实例，更深层的含义是 <code>of</code> 方法用来把值直接放到上下文 Context(把值放到容器中，使用 map 来处理值)，这个也是一直在使用的函子 </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Container</span> &#123;<br>    <span class="hljs-title function_">constructor</span> (value) &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_value</span> = value<br>    &#125;<br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">of</span> (value) &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Container</span>(value)<br>    &#125;<br>  &#125;<br></code></pre></td></tr></table></figure>

<h3 id="Monad-单-函子"><a href="#Monad-单-函子" class="headerlink" title="Monad (单)函子"></a>Monad (单)函子</h3><ul>
<li><code>monad</code> 函子是可以变扁的 <code>Pointed</code> 函子, <code>IO(IO(x))</code></li>
<li>一个函子如果有 <code>join</code> 和 <code>of</code> 两个方法并遵守一些定律就是一个 Monad</li>
</ul>
<p>来吧，最后一个展示</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> fp = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;lodash/fp&#x27;</span>)<br>  <span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>)<br><br>  <span class="hljs-comment">// IO Monad</span><br>  <span class="hljs-keyword">class</span> <span class="hljs-title class_">IO</span> &#123;<br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">of</span> = <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> <span class="hljs-keyword">new</span> <span class="hljs-title function_">IO</span>(<span class="hljs-function">() =&gt;</span> value)<br><br>    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">fn</span>) &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_value</span> = fn<br>    &#125;<br><br>    map (fn) &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title function_">IO</span>(fp.<span class="hljs-title function_">flowRight</span>(fn, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_value</span>))<br>    &#125;<br>    <span class="hljs-comment">// 使用 json 方法 把函子变扁拍平，也就是调用一次</span><br>    join () &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_value</span>()<br>    &#125;<br><br>    flatMap (fn) &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">map</span>(fn).<span class="hljs-title function_">join</span>()<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-keyword">let</span> <span class="hljs-title function_">readFile</span> = filename =&gt; <span class="hljs-keyword">new</span> <span class="hljs-title function_">IO</span>(<span class="hljs-function">() =&gt;</span> fs.<span class="hljs-title function_">readFileSync</span>(filename, <span class="hljs-string">&#x27;utf-8&#x27;</span>))<br><br>  <span class="hljs-keyword">let</span> <span class="hljs-title function_">print</span> = x =&gt; <span class="hljs-keyword">new</span> <span class="hljs-title function_">IO</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(x)<br>    <span class="hljs-keyword">return</span> x<br>  &#125;)<br><br>  <span class="hljs-keyword">let</span> r = <span class="hljs-title function_">readFile</span>(<span class="hljs-string">&#x27;package.json&#x27;</span>)<br>    .<span class="hljs-title function_">map</span>(fp.<span class="hljs-property">toUpper</span>)<br>    .<span class="hljs-title function_">flatMap</span>(print)<br>    .<span class="hljs-title function_">join</span>()<br><br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(r)<br></code></pre></td></tr></table></figure>
              
            </div>
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/JavaScript/" class="category-chain-item">JavaScript</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E5%8E%9F%E5%88%9B/">#原创</a>
      
        <a href="/tags/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/">#函数式编程</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>函数式编程</div>
      <div>http://example.com/2021/07/21/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>John Doe</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2021年7月21日</div>
        </div>
      
      
      <div class="license-meta-item">
        <div>许可协议</div>
        <div>
          
            
            
              <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
              <span class="hint--top hint--rounded" aria-label="BY - 署名">
                <i class="iconfont icon-by"></i>
              </span>
              </a>
            
          
        </div>
      </div>
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/03/01/hello-world/" title="Hello World">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Hello World</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/06/10/%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0/" title="测试文章">
                        <span class="hidden-mobile">测试文章</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  <article id="comments" lazyload>
    
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.4.16/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"8rcPnaazaIKIPGc5YcAz2caW-gzGzoHsz","appKey":"49vPklmXhfvaJRzOy9LCGwbe","path":"window.location.pathname","placeholder":null,"avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":false},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


  </article>


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  






    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  

  

  

  

  

  

  




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.0/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script>
  (function() {
    var enableLang = CONFIG.code_language.enable && CONFIG.code_language.default;
    var enableCopy = CONFIG.copy_btn;
    if (!enableLang && !enableCopy) {
      return;
    }

    function getBgClass(ele) {
      return Fluid.utils.getBackgroundLightness(ele) >= 0 ? 'code-widget-light' : 'code-widget-dark';
    }

    var copyTmpl = '';
    copyTmpl += '<div class="code-widget">';
    copyTmpl += 'LANG';
    copyTmpl += '</div>';
    jQuery('.markdown-body pre').each(function() {
      var $pre = jQuery(this);
      if ($pre.find('code.mermaid').length > 0) {
        return;
      }
      if ($pre.find('span.line').length > 0) {
        return;
      }

      var lang = '';

      if (enableLang) {
        lang = CONFIG.code_language.default;
        if ($pre[0].children.length > 0 && $pre[0].children[0].classList.length >= 2 && $pre.children().hasClass('hljs')) {
          lang = $pre[0].children[0].classList[1];
        } else if ($pre[0].getAttribute('data-language')) {
          lang = $pre[0].getAttribute('data-language');
        } else if ($pre.parent().hasClass('sourceCode') && $pre[0].children.length > 0 && $pre[0].children[0].classList.length >= 2) {
          lang = $pre[0].children[0].classList[1];
          $pre.parent().addClass('code-wrapper');
        } else if ($pre.parent().hasClass('markdown-body') && $pre[0].classList.length === 0) {
          $pre.wrap('<div class="code-wrapper"></div>');
        }
        lang = lang.toUpperCase().replace('NONE', CONFIG.code_language.default);
      }
      $pre.append(copyTmpl.replace('LANG', lang).replace('code-widget">',
        getBgClass($pre[0]) + (enableCopy ? ' code-widget copy-btn" data-clipboard-snippet><i class="iconfont icon-copy"></i>' : ' code-widget">')));

      if (enableCopy) {
        Fluid.utils.createScript('https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js', function() {
          var clipboard = new window.ClipboardJS('.copy-btn', {
            target: function(trigger) {
              var nodes = trigger.parentNode.childNodes;
              for (var i = 0; i < nodes.length; i++) {
                if (nodes[i].tagName === 'CODE') {
                  return nodes[i];
                }
              }
            }
          });
          clipboard.on('success', function(e) {
            e.clearSelection();
            e.trigger.innerHTML = e.trigger.innerHTML.replace('icon-copy', 'icon-success');
            setTimeout(function() {
              e.trigger.innerHTML = e.trigger.innerHTML.replace('icon-success', 'icon-copy');
            }, 2000);
          });
        });
      }
    });
  })();
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="/js/leancloud.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
